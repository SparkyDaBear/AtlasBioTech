{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Variant Datacard Schema - qDMS Format",
  "type": "object",
  "required": [
    "gene",
    "variant_string", 
    "protein_change",
    "position",
    "reference_aa",
    "mutant_aa",
    "netgr_data"
  ],
  "properties": {
    "gene": {
      "type": "string",
      "pattern": "^[A-Z0-9-]+$",
      "description": "Gene symbol (e.g., BCR-ABL, EGFR)"
    },
    "variant_string": {
      "type": "string",
      "description": "Variant notation (e.g., A102D, T315I)"
    },
    "protein_change": {
      "type": "string",
      "pattern": "^p\\.[A-Z][0-9]+[A-Z]$",
      "description": "Protein change notation (e.g., p.A102D)"
    },
    "position": {
      "type": "integer",
      "minimum": 1,
      "description": "Amino acid position in protein"
    },
    "reference_aa": {
      "type": "string",
      "pattern": "^[A-Z]$",
      "description": "Reference (wild-type) amino acid single letter code"
    },
    "mutant_aa": {
      "type": "string", 
      "pattern": "^[A-Z]$",
      "description": "Mutant amino acid single letter code"
    },
    "drugs_tested": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "description": "List of drugs tested against this variant"
    },
    "model_system": {
      "type": "string",
      "description": "Cell line or model system used for testing"
    },
    "netgr_data": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["drug", "concentration", "netgr_mean"],
        "properties": {
          "drug": {
            "type": "string",
            "description": "Drug name"
          },
          "concentration": {
            "type": "number",
            "minimum": 0,
            "description": "Drug concentration in Î¼M"
          },
          "dose_level": {
            "type": "string",
            "enum": ["low", "medium", "high"],
            "description": "Categorical dose level"
          },
          "netgr_mean": {
            "type": "number",
            "description": "Mean net growth rate across replicates"
          },
          "netgr_std": {
            "type": ["number", "null"],
            "minimum": 0,
            "description": "Standard deviation of net growth rate across replicates"
          },
          "netgr_raw_values": {
            "type": "array",
            "items": {
              "type": "number"
            },
            "description": "Individual replicate net growth rate values"
          },
          "replicate_count": {
            "type": "integer",
            "minimum": 1,
            "description": "Number of experimental replicates"
          },
          "confidence_interval": {
            "type": "array",
            "items": {
              "type": "number"
            },
            "minItems": 2,
            "maxItems": 2,
            "description": "95% confidence interval [lower, upper]"
          },
          "qc_flags": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "high_variability",
                "low_replicate_count", 
                "outlier_detected",
                "insufficient_data",
                "negative_growth"
              ]
            },
            "description": "Quality control flags"
          }
        }
      },
      "minItems": 1
    },
    "publication_doi": {
      "type": "string", 
      "pattern": "^10\\.[0-9]+/.*$",
      "description": "DOI of associated publication"
    },
    "plots": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["drug", "plot_url"],
        "properties": {
          "drug": {
            "type": "string"
          },
          "plot_url": {
            "type": "string",
            "format": "uri-reference", 
            "description": "URL to dose-response plot (SVG/PNG)"
          },
          "plot_type": {
            "type": "string",
            "enum": ["dose_response", "time_course", "heat_map", "growth_curve"],
            "default": "dose_response"
          }
        }
      }
    },
    "pdb_structure": {
      "type": "object",
      "properties": {
        "pdb_id": {
          "type": "string",
          "pattern": "^[0-9A-Z]{4}$",
          "description": "PDB structure identifier"
        },
        "chain": {
          "type": "string",
          "pattern": "^[A-Z]$",
          "description": "Protein chain identifier"
        },
        "residue_number": {
          "type": "integer",
          "minimum": 1,
          "description": "Residue number in PDB structure"
        },
        "pocket_residues": {
          "type": "array",
          "items": {
            "type": "integer"
          },
          "description": "Residue numbers defining binding pocket"
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "date_created": {
          "type": "string",
          "format": "date-time"
        },
        "date_modified": {
          "type": "string",
          "format": "date-time"
        },
        "created_by": {
          "type": "string"
        },
        "version": {
          "type": "string"
        },
        "data_format": {
          "type": "string",
          "enum": ["qDMS", "IC50", "other"],
          "description": "Type of experimental data"
        }
      }
    }
  }
}